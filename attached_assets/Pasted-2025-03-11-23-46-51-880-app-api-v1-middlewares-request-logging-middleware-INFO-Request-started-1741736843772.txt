2025-03-11 23:46:51,880 - app.api.v1.middlewares.request_logging_middleware - INFO - Request started: GET /api/v1/documents
2025-03-11 23:46:51,881 - app.api.v1.middlewares.request_logging_middleware - DEBUG - Request details: headers={'host': '46c6dd23-92b6-42e0-8441-207276f1a744-00-ypuyupxvbz8d.riker.replit.dev', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36', 'accept': 'application/json, text/plain, */*', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'tr-TR,tr;q=0.9,en-US;q=0.8,en;q=0.7,la;q=0.6', 'authorization': 'Bearer [REDACTED]', 'origin': 'https://53b27c3e-da65-4fbf-9f03-915d7ef74134-00-1xegreh0l3jg3.kirk.replit.dev', 'referer': 'https://53b27c3e-da65-4fbf-9f03-915d7ef74134-00-1xegreh0l3jg3.kirk.replit.dev/', 'sec-ch-ua': '"Not(A:Brand";v="99", "Google Chrome";v="133", "Chromium";v="133"', 'sec-ch-ua-mobile': '?0', 'sec-ch-ua-platform': '"Windows"', 'sec-fetch-dest': 'empty', 'sec-fetch-mode': 'cors', 'sec-fetch-site': 'cross-site', 'x-forwarded-for': '176.40.242.146, 10.81.3.205', 'x-forwarded-proto': 'https', 'x-replit-user-bio': '', 'x-replit-user-id': '', 'x-replit-user-name': '', 'x-replit-user-profile-image': '', 'x-replit-user-roles': '', 'x-replit-user-teams': '', 'x-replit-user-url': ''}, query_params={'page': '1', 'per_page': '20'}
2025-03-11 23:46:51,882 - app.core.security - DEBUG - Successfully decoded token for user: tunaycl@outlook.com
2025-03-11 23:46:51,882 - app.core.services.redis_service - DEBUG - Created new RedisService instance
2025-03-11 23:46:51,882 - app.core.services.redis_service - DEBUG - Initializing new Redis connection...
2025-03-11 23:46:52,519 - app.core.services.redis_service - INFO - Successfully established Redis connection
2025-03-11 23:46:52,678 - app.core.services.redis_service - DEBUG - Successfully retrieved Redis key: user:user_qTSfFwc7HRuRaEqqYwpjiHzdq
2025-03-11 23:46:52,678 - app.core.security - INFO - Retrieved user data from Redis cache for fp: user_qTSfFwc7HRuRaEqqYwpjiHzdq
2025-03-11 23:46:52,678 - app.api.v1.auth - DEBUG - Using cached user data for fp: user_qTSfFwc7HRuRaEqqYwpjiHzdq
2025-03-11 23:46:53,156 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-03-11 23:46:53,156 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-11 23:46:53,157 INFO sqlalchemy.engine.Engine SELECT users.id, users.fp, users.email, users.hashed_password, users.full_name, users.role, users.is_active, users.last_login, users.created_at, users.updated_at 
FROM users 
WHERE users.fp = $1::VARCHAR
2025-03-11 23:46:53,157 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.fp, users.email, users.hashed_password, users.full_name, users.role, users.is_active, users.last_login, users.created_at, users.updated_at 
FROM users 
WHERE users.fp = $1::VARCHAR
2025-03-11 23:46:53,158 INFO sqlalchemy.engine.Engine [cached since 3.056s ago] ('user_qTSfFwc7HRuRaEqqYwpjiHzdq',)
2025-03-11 23:46:53,158 - sqlalchemy.engine.Engine - INFO - [cached since 3.056s ago] ('user_qTSfFwc7HRuRaEqqYwpjiHzdq',)
2025-03-11 23:46:53,478 - app.api.v1.middlewares.validation_middleware - INFO - Pagination request: page=1, per_page=20
2025-03-11 23:46:53,479 - app.api.v1.document_routes - INFO - Fetching documents for user 1, page 1, per_page 20
2025-03-11 23:46:55,166 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-03-11 23:46:55,166 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-11 23:46:55,172 INFO sqlalchemy.engine.Engine SELECT users.id, users.fp, users.email, users.hashed_password, users.full_name, users.role, users.is_active, users.last_login, users.created_at, users.updated_at, organizations_1.id AS id_1, organizations_1.name, organizations_1.description, organizations_1.created_at AS created_at_1, organizations_1.updated_at AS updated_at_1 
FROM users LEFT OUTER JOIN (user_organizations AS user_organizations_1 JOIN organizations AS organizations_1 ON organizations_1.id = user_organizations_1.organization_id) ON users.id = user_organizations_1.user_id 
WHERE users.id = $1::INTEGER
2025-03-11 23:46:55,172 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.fp, users.email, users.hashed_password, users.full_name, users.role, users.is_active, users.last_login, users.created_at, users.updated_at, organizations_1.id AS id_1, organizations_1.name, organizations_1.description, organizations_1.created_at AS created_at_1, organizations_1.updated_at AS updated_at_1 
FROM users LEFT OUTER JOIN (user_organizations AS user_organizations_1 JOIN organizations AS organizations_1 ON organizations_1.id = user_organizations_1.organization_id) ON users.id = user_organizations_1.user_id 
WHERE users.id = $1::INTEGER
2025-03-11 23:46:55,172 INFO sqlalchemy.engine.Engine [generated in 0.00040s] (1,)
2025-03-11 23:46:55,172 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] (1,)
2025-03-11 23:46:56,812 INFO sqlalchemy.engine.Engine ROLLBACK
2025-03-11 23:46:56,812 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-11 23:46:56,970 - app.core.services.document_service - ERROR - Error fetching user accessible documents: 'User.organizations' does not support object population - eager loading cannot be applied.
2025-03-11 23:46:56,970 - app.api.v1.document_routes - ERROR - Error listing user documents: 'User.organizations' does not support object population - eager loading cannot be applied.
Traceback (most recent call last):
  File "/home/runner/workspace/app/api/v1/document_routes.py", line 151, in list_user_documents
    documents, total_count = await document_service.get_user_accessible_documents(
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/app/core/services/document_service.py", line 397, in get_user_accessible_documents
    result = await session.execute(user_stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 308, in orm_execute_statement
    return cls.orm_setup_cursor_result(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 600, in orm_setup_cursor_result
    return loading.instances(result, querycontext)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 132, in instances
    with util.safe_reraise():
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 113, in instances
    *[
     ^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 114, in <listcomp>
    query_entity.row_processor(context, cursor)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 2723, in row_processor
    _instance = loading._instance_processor(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 958, in _instance_processor
    prop.create_row_processor(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/interfaces.py", line 1093, in create_row_processor
    strat.create_row_processor(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 2811, in create_row_processor
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: 'User.organizations' does not support object population - eager loading cannot be applied.
2025-03-11 23:46:56,989 INFO sqlalchemy.engine.Engine ROLLBACK
2025-03-11 23:46:56,989 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-11 23:46:57,148 - app.main - WARNING - HTTP exception: An error occurred while fetching documents
2025-03-11 23:46:57,148 - app.main - DEBUG - Created standard error detail structure: {'message': 'An error occurred while fetching documents', 'logout': False, 'details': [{'msg': 'An error occurred while fetching documents'}]}
2025-03-11 23:46:57,149 - app.api.v1.middlewares.request_logging_middleware - INFO - Request completed: GET /api/v1/documents - Status: 500 (Duration: 5.27s)
INFO:     172.31.128.57:59404 - "GET /api/v1/documents?page=1&per_page=20 HTTP/1.1" 500 Internal Server Error